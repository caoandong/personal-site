@import 'tailwindcss';
@import 'katex/dist/katex.min.css';

@plugin '@tailwindcss/typography';

:root {
  --background: #fafafa; /* neutral-50 */
  --foreground: #0a0a0a;
  --heading: #171717; /* neutral-900 */
  --body: #404040; /* neutral-700 */
  --muted: #f4f4f5;
  --muted-foreground: #71717a;
  --grey-1: #52525b;
  --grey-2: #a1a1aa;
  --border: #e4e4e7;
  --stroke: #e4e4e7;
  --primary: #18181b;
  --primary-foreground: #fafafa;

  /* Lightray Configuration */
  --lightray-opacity: 1;
  --lightray-blur: 40px;
  --lightray-width: 120px;
  --lightray-angle: 45deg;
  --lightray-shimmer-duration: 8s;
  --lightray-sway-duration: 15s;

  /* Rainbow colors - TESTING with high visibility */
  --lightray-color-1: rgba(255, 80, 80, 1);
  --lightray-color-2: rgba(255, 160, 60, 1);
  --lightray-color-3: rgba(255, 230, 80, 1);
  --lightray-color-4: rgba(80, 255, 130, 1);
  --lightray-color-5: rgba(80, 160, 255, 1);
  --lightray-color-6: rgba(160, 80, 255, 1);
}

.dark {
  --background: #0a0a0a;
  --foreground: #fafafa;
  --heading: #f5f5f5; /* neutral-100 */
  --body: #d4d4d4; /* neutral-300 */
  --muted: #27272a;
  --muted-foreground: #a1a1aa;
  --grey-1: #a1a1aa;
  --grey-2: #71717a;
  --border: #27272a;
  --stroke: #27272a;
  --primary: #fafafa;
  --primary-foreground: #18181b;

  /* Lightray - more visible on dark backgrounds */
  --lightray-opacity: 1;
  --lightray-blur: 40px;
  --lightray-width: 120px;
  --lightray-shimmer-duration: 8s;
  --lightray-sway-duration: 15s;

  /* Rainbow colors - TESTING with high visibility */
  --lightray-color-1: rgba(255, 80, 80, 1);
  --lightray-color-2: rgba(255, 160, 60, 1);
  --lightray-color-3: rgba(255, 230, 80, 1);
  --lightray-color-4: rgba(80, 255, 130, 1);
  --lightray-color-5: rgba(80, 160, 255, 1);
  --lightray-color-6: rgba(160, 80, 255, 1);
}

/*
 * SINGLE SOURCE OF TRUTH: All design tokens defined here via @theme
 * Tailwind generates utilities (text-h1, text-body, etc.) from these tokens
 *
 * Note: @theme requires explicit values, not var() references to other theme
 * variables, because it's processed at build time.
 */
@theme inline {
  /* Colors */
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-heading: var(--heading);
  --color-body: var(--body);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-grey-1: var(--grey-1);
  --color-grey-2: var(--grey-2);
  --color-border: var(--border);
  --color-stroke: var(--stroke);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);

  /*
   * Typography Scale - SINGLE SOURCE OF TRUTH
   * Mobile-first with responsive overrides via Tailwind breakpoints
   *
   * Usage: text-h1, text-h2, text-h3, text-body, text-small, text-nav
   * These generate Tailwind utilities automatically
   */

  /* Heading 1: text-3xl on mobile → text-5xl (md/lg) */
  --font-size-h1: 1.875rem; /* 30px - text-3xl */
  --font-size-h1-md: 3rem; /* 48px - text-5xl */
  --font-size-h1-lg: 3rem; /* 48px - text-5xl */
  --line-height-h1: 1.2;

  /* Heading 2: text-xl on mobile → text-2xl (md) */
  --font-size-h2: 1.25rem; /* 20px - text-xl */
  --font-size-h2-md: 1.5rem; /* 24px - text-2xl */
  --line-height-h2: 1.3;

  /* Heading 3: text-xl */
  --font-size-h3: 1.25rem; /* 20px - text-xl */
  --font-size-h3-md: 1.25rem; /* 20px - text-xl */
  --line-height-h3: 1.4;

  /* Body text */
  --font-size-body: 1.25rem; /* 20px - text-xl */
  --line-height-body: 1.625; /* leading-relaxed */

  /* Code text (slightly smaller than body for visual consistency with monospace) */
  --font-size-code: 0.975rem; /* ~15.6px */

  /* Small/caption text */
  --font-size-small: 1.125rem; /* 18px - text-lg */
  --line-height-small: 1.5;

  /* Navigation text */
  --font-size-nav: 1.125rem; /* 18px - text-lg */
  --line-height-nav: 1.5;

  /* Spacing tokens for typography */
  --spacing-h1-mt: 3rem; /* mt-12 */
  --spacing-h1-mb: 3rem; /* mb-8 */
  --spacing-h2-mt: 5rem; /* mt-20 */
  --spacing-h2-mb: 1.5rem; /* mb-6 */
  --spacing-h3-mt: 3.5rem; /* mt-14 */
  --spacing-h3-mb: 1rem; /* mb-4 */
  --spacing-p-my: 1.5rem; /* my-6 */
  --spacing-list-my: 2rem; /* my-8 */
  --spacing-li-mt: 0.75rem; /* mt-3 */
  --spacing-blockquote-my: 2rem; /* my-8 */
}

body {
  background: var(--background);
  color: var(--body);
  font-weight: 300;
}

/* Smooth transitions for interactive elements */
a {
  transition: color 200ms ease;
}

a:hover {
  color: var(--heading);
}

/* Prose styling for MDX content */
.prose {
  --tw-prose-body: var(--body);
  --tw-prose-headings: var(--heading);
  --tw-prose-links: var(--body);
  --tw-prose-bold: var(--heading);
  --tw-prose-code: var(--body);
  --tw-prose-quotes: var(--body);
  --tw-prose-counters: var(--grey-1);
  --tw-prose-bullets: var(--grey-1);
  --tw-prose-hr: var(--stroke);
  --tw-prose-quote-borders: var(--stroke);
}

/*
 * Prose heading styles - using @theme tokens as single source of truth
 * Font sizes, line heights, and spacing all reference the tokens above
 */
.prose h1,
.prose h2,
.prose h3 {
  font-weight: 300;
  letter-spacing: -0.02em;
}

.prose h1 {
  font-size: var(--font-size-h1);
  line-height: var(--line-height-h1);
  margin-top: var(--spacing-h1-mt);
  margin-bottom: var(--spacing-h1-mb);
}

.prose h2 {
  font-size: var(--font-size-h2);
  line-height: var(--line-height-h2);
  margin-top: var(--spacing-h2-mt);
  margin-bottom: var(--spacing-h2-mb);
}

.prose h3 {
  font-size: var(--font-size-h3);
  line-height: var(--line-height-h3);
  margin-top: var(--spacing-h3-mt);
  margin-bottom: var(--spacing-h3-mb);
}

.prose p {
  margin-top: var(--spacing-p-my);
  margin-bottom: var(--spacing-p-my);
  line-height: var(--line-height-body);
}

.prose ul,
.prose ol {
  margin-top: var(--spacing-list-my);
  margin-bottom: var(--spacing-list-my);
}

.prose li {
  margin-top: var(--spacing-li-mt);
}

.prose blockquote {
  margin-top: var(--spacing-blockquote-my);
  margin-bottom: var(--spacing-blockquote-my);
}

/* First child headings have no top margin */
.prose > h1:first-child,
.prose > h2:first-child,
.prose > h3:first-child {
  margin-top: 0;
}

/* Responsive font sizes using @theme tokens */
@media (min-width: 768px) {
  .prose h1 {
    font-size: var(--font-size-h1-md);
  }
  .prose h2 {
    font-size: var(--font-size-h2-md);
  }
  .prose h3 {
    font-size: var(--font-size-h3-md);
  }
}

@media (min-width: 1024px) {
  .prose h1 {
    font-size: var(--font-size-h1-lg);
  }
}

/* Ensure prose links don't inherit global hover */
.prose a:hover {
  color: var(--heading);
}

/* Inline code styling */
.prose code:not(pre code) {
  background-color: var(--muted);
  padding: 0.2rem 0.4rem;
  border-radius: 0.25rem;
  font-size: var(--font-size-code);
  font-weight: 500;
}

/* Code block styling for rehype-pretty-code */
pre {
  border-radius: 0.75rem;
  padding: 1.25rem 1.5rem;
  margin-top: 2.5rem;
  margin-bottom: 2.5rem;
  overflow-x: auto;
  font-size: var(--font-size-code);
  line-height: 1.7;
  background-color: var(--muted);
}

.dark pre {
  background-color: #141414;
}

pre > code {
  display: grid;
}

/* Shiki dual theme - transparent spans so pre's rounded corners show */
pre [data-theme*=' '],
pre [data-theme*=' '] span {
  color: var(--shiki-light);
  background-color: transparent;
}

.dark pre [data-theme*=' '],
.dark pre [data-theme*=' '] span {
  color: var(--shiki-dark);
  background-color: transparent;
}

/* KaTeX styling adjustments */
.katex-display {
  overflow-x: auto;
  overflow-y: hidden;
  padding: 1rem 0;
}

/* Page entrance animations */
@keyframes animate-in {
  from {
    opacity: 0;
    filter: blur(4px);
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    filter: blur(0);
    transform: translateY(0);
  }
}

/*
 * Auto-stagger: animates direct children in sequence
 *
 * IMPORTANT: Set initial state explicitly to prevent FOUC on mobile.
 * Without this, content flashes visible before animation applies opacity: 0.
 * The animation-fill-mode: forwards then animates to visible state.
 */
[data-animate-stagger] > * {
  --stagger: 0;
  /* Explicit initial state - prevents flash before animation starts */
  opacity: 0;
  filter: blur(4px);
  transform: translateY(10px);
  /* Use 'forwards' since initial state is set explicitly above */
  animation: animate-in 0.4s ease-out forwards;
  animation-delay: calc(var(--stagger) * 60ms);
}

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  [data-animate-stagger] > * {
    /* Reset to visible state - no animation */
    opacity: 1;
    filter: none;
    transform: none;
    animation: none;
  }
}

/* Fallback for no-js environments (added via noscript in layout) */
.no-js [data-animate-stagger] > * {
  opacity: 1;
  filter: none;
  transform: none;
  animation: none;
}

/* ==========================================================================
   Lightray Effect
   ========================================================================== */

/* Keyframe animations */
@keyframes lightray-shimmer {
  0%, 100% { opacity: var(--lightray-opacity); }
  30% { opacity: calc(var(--lightray-opacity) * 0.3); }
  60% { opacity: calc(var(--lightray-opacity) * 0.7); }
  80% { opacity: calc(var(--lightray-opacity) * 0.4); }
}

@keyframes lightray-sway {
  0%, 100% { translate: 0 0; rotate: 0deg; }
  25% { translate: -15px 5px; rotate: -1.5deg; }
  50% { translate: -25px 12px; rotate: 1deg; }
  75% { translate: -10px 8px; rotate: -0.5deg; }
}

@keyframes lightray-rainbow-shift {
  0% { background-position: 0% 50%; }
  100% { background-position: 200% 50%; }
}

/* Lightray container */
.lightray-container {
  position: fixed;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: 0;
}

/* Base ray styling - shared properties */
.lightray {
  position: absolute;
  top: -10%;
  height: 140%;
  transform-origin: top center;
  mix-blend-mode: screen;
  /* Radial fade for natural light falloff */
  mask-image: radial-gradient(
    ellipse 50% 60% at 50% 0%,
    black 0%,
    rgba(0,0,0,0.5) 30%,
    rgba(0,0,0,0.15) 60%,
    transparent 100%
  );
  -webkit-mask-image: radial-gradient(
    ellipse 50% 60% at 50% 0%,
    black 0%,
    rgba(0,0,0,0.5) 30%,
    rgba(0,0,0,0.15) 60%,
    transparent 100%
  );
}

/* Individual rays ordered left-to-right as rainbow: red → orange → yellow → green → blue */
.lightray-1 {
  /* Red - leftmost */
  right: 12%;
  width: 90px;
  background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--lightray-color-1) 35%, transparent), transparent);
  filter: blur(35px);
  transform: rotate(44deg);
  animation:
    lightray-shimmer 10s ease-in-out infinite,
    lightray-sway 18s ease-in-out infinite;
  animation-delay: 0s;
}

.lightray-2 {
  /* Orange */
  right: 10%;
  width: 80px;
  background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--lightray-color-2) 35%, transparent), transparent);
  filter: blur(38px);
  transform: rotate(45deg);
  animation:
    lightray-shimmer 11s ease-in-out infinite,
    lightray-sway 20s ease-in-out infinite;
  animation-delay: -2s;
}

.lightray-3 {
  /* Yellow */
  right: 8%;
  width: 100px;
  background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--lightray-color-3) 35%, transparent), transparent);
  filter: blur(42px);
  transform: rotate(46deg);
  animation:
    lightray-shimmer 12s ease-in-out infinite,
    lightray-sway 22s ease-in-out infinite;
  animation-delay: -4s;
}

.lightray-4 {
  /* Green */
  right: 6%;
  width: 85px;
  background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--lightray-color-4) 35%, transparent), transparent);
  filter: blur(40px);
  transform: rotate(47deg);
  animation:
    lightray-shimmer 13s ease-in-out infinite,
    lightray-sway 19s ease-in-out infinite;
  animation-delay: -6s;
}

.lightray-5 {
  /* Blue - rightmost */
  right: 4%;
  width: 95px;
  background: linear-gradient(90deg, transparent, color-mix(in srgb, var(--lightray-color-5) 35%, transparent), transparent);
  filter: blur(45px);
  transform: rotate(48deg);
  animation:
    lightray-shimmer 14s ease-in-out infinite,
    lightray-sway 21s ease-in-out infinite;
  animation-delay: -8s;
}

.lightray-center {
  /* Wide neutral center ray */
  right: 6%;
  width: 180px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 250, 0.9), transparent);
  filter: blur(50px);
  transform: rotate(46deg);
  animation:
    lightray-shimmer 15s ease-in-out infinite,
    lightray-sway 24s ease-in-out infinite;
  animation-delay: -5s;
}

/* Reduced motion: static ray */
@media (prefers-reduced-motion: reduce) {
  .lightray {
    animation: none;
    opacity: var(--lightray-opacity);
  }
  .lightray-rainbow {
    animation: none;
  }
}

/* Mobile: reduce blur for performance */
@media (max-width: 768px) {
  .lightray-container {
    --lightray-blur: 40px;
    --lightray-opacity: 0.1;
  }
  .dark .lightray-container {
    --lightray-opacity: 0.15;
  }
}
